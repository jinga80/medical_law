{% extends 'base.html' %}
{% load static %}

{% block title %}{{ candidate.name }} - 상세 정보{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page title -->
    <div class="row">
        <div class="col-12">
            {% with title=candidate.name|add:" - 상세 정보" icon="mdi-account" breadcrumbs=breadcrumbs %}
                {% include 'includes/page_title.html' %}
            {% endwith %}
        </div>
    </div>

    <div class="row">
        <div class="col-xl-4 col-lg-5">
            <div class="card text-center">
                <div class="card-body">
                    <div class="mb-3">
                        {% if candidate.profile_image %}
                            <img src="{{ candidate.profile_image.url }}" class="rounded-circle avatar-lg img-thumbnail" alt="프로필 이미지">
                        {% else %}
                            <div class="avatar-lg mx-auto bg-primary rounded-circle d-flex align-items-center justify-content-center">
                                <span class="text-white font-weight-bold" style="font-size: 2rem;">{{ candidate.name|first|upper }}</span>
                            </div>
                        {% endif %}
                    </div>

                    <h4 class="mb-1">{{ candidate.name }}</h4>
                    <p class="text-muted">{{ candidate.target_position }}</p>

                    <div class="mt-3">
                        <span class="badge bg-{% if candidate.status == 'waiting' %}warning{% elif candidate.status == 'approved' %}success{% elif candidate.status == 'rejected' %}danger{% else %}secondary{% endif %} mb-1">
                            {{ candidate.get_status_display }}
                        </span>
                        <br>
                        <span class="badge bg-{% if candidate.review_status == 'pending' %}warning{% elif candidate.review_status == 'passed' %}success{% elif candidate.review_status == 'failed' %}danger{% else %}info{% endif %}">
                            {{ candidate.get_review_status_display }}
                        </span>
                    </div>

                    <div class="text-start mt-3">
                        <h4 class="font-13 text-uppercase">기본 정보</h4>
                        <p class="text-muted font-13 mb-3">
                            <strong>이메일:</strong> {{ candidate.email }}<br>
                            <strong>전화번호:</strong> {{ candidate.phone }}<br>
                            <strong>생년월일:</strong> {{ candidate.date_of_birth|date:"Y-m-d"|default:"-" }}<br>
                            <strong>성별:</strong> {{ candidate.get_gender_display|default:"-" }}
                        </p>

                        <h4 class="font-13 text-uppercase">경력 정보</h4>
                        <p class="text-muted font-13 mb-3">
                            <strong>경력:</strong> {{ candidate.years_of_experience }}년<br>
                            <strong>최종학력:</strong> {{ candidate.get_education_level_display }}<br>
                            <strong>전공:</strong> {{ candidate.major|default:"-" }}<br>
                            <strong>현재 직장:</strong> {{ candidate.current_company|default:"-" }}
                        </p>

                        <h4 class="font-13 text-uppercase">추천 정보</h4>
                        <p class="text-muted font-13 mb-0">
                            <strong>추천일:</strong> {{ candidate.created_at|date:"Y-m-d" }}<br>
                            <strong>추천자:</strong> {{ candidate.recommended_by.get_full_name|default:"-" }}<br>
                            <strong>추천 이유:</strong> {{ candidate.recommendation_reason|default:"-" }}
                        </p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h4 class="header-title mb-3">작업</h4>
                    <div class="d-grid gap-2">
                        {% if user.is_hospital_user or user.is_admin_user %}
                            {% if candidate.can_start_review %}
                                <a href="{% url 'candidates:review' candidate.id %}" class="btn btn-primary">
                                    <i class="mdi mdi-clipboard-check me-2"></i>검토 시작
                                </a>
                            {% endif %}
                            
                            {% if candidate.review_status == 'passed' %}
                                <a href="{% url 'candidates:interview_evaluation' candidate.id %}" class="btn btn-success">
                                    <i class="mdi mdi-account-check me-2"></i>면접 평가
                                </a>
                            {% endif %}
                            
                            <a href="{% url 'candidates:status_update' candidate.id %}" class="btn btn-info">
                                <i class="mdi mdi-account-edit me-2"></i>상태 변경
                            </a>
                        {% endif %}
                        
                        {% if user.is_headhunting_user or user.is_admin_user %}
                            <a href="{% url 'candidates:edit' candidate.id %}" class="btn btn-warning">
                                <i class="mdi mdi-pencil me-2"></i>정보 수정
                            </a>
                        {% endif %}
                        
                        <a href="{% url 'candidates:note_add' candidate.id %}" class="btn btn-secondary">
                            <i class="mdi mdi-note-plus me-2"></i>메모 추가
                        </a>
                        
                        {% if candidate.resume %}
                            <a href="{{ candidate.resume.url }}" class="btn btn-info" target="_blank">
                                <i class="mdi mdi-file-document me-2"></i>이력서 보기
                            </a>
                        {% endif %}
                        <a href="#" class="btn btn-secondary">
                            <i class="mdi mdi-calendar me-2"></i>면접 일정
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-8 col-lg-7">
            <div class="card">
                <div class="card-body">
                    <ul class="nav nav-pills nav-fill navtab-bg">
                        <li class="nav-item">
                            <a href="#resume" data-bs-toggle="tab" aria-expanded="true" class="nav-link active">
                                이력서
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#evaluations" data-bs-toggle="tab" aria-expanded="false" class="nav-link">
                                평가 내역
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#interviews" data-bs-toggle="tab" aria-expanded="false" class="nav-link">
                                면접 내역
                            </a>
                        </li>
                    </ul>

                    <div class="tab-content">
                        <div class="tab-pane show active" id="resume">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>개인 정보</h5>
                                    <table class="table table-sm">
                                        <tr>
                                            <td><strong>이름:</strong></td>
                                            <td>{{ candidate.name }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>이메일:</strong></td>
                                            <td>{{ candidate.email }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>전화번호:</strong></td>
                                            <td>{{ candidate.phone }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>주소:</strong></td>
                                            <td>{{ candidate.address|default:"-" }}</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <h5>학력 정보</h5>
                                    <table class="table table-sm">
                                        <tr>
                                            <td><strong>최종학력:</strong></td>
                                            <td>{{ candidate.get_education_level_display }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>전공:</strong></td>
                                            <td>{{ candidate.major|default:"-" }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>졸업학교:</strong></td>
                                            <td>{{ candidate.school|default:"-" }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>졸업년도:</strong></td>
                                            <td>{{ candidate.graduation_year|default:"-" }}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <div class="row mt-3">
                                <div class="col-12">
                                    <h5>경력 사항</h5>
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>기간</th>
                                                    <th>회사명</th>
                                                    <th>직책</th>
                                                    <th>담당업무</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for experience in candidate.experiences.all %}
                                                <tr>
                                                    <td>{{ experience.start_date|date:"Y-m" }} ~ {{ experience.end_date|date:"Y-m"|default:"현재" }}</td>
                                                    <td>{{ experience.company_name }}</td>
                                                    <td>{{ experience.position }}</td>
                                                    <td>{{ experience.description }}</td>
                                                </tr>
                                                {% empty %}
                                                <tr>
                                                    <td colspan="4" class="text-center">경력 정보가 없습니다.</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            {% if candidate.skills %}
                            <div class="row mt-3">
                                <div class="col-12">
                                    <h5>보유 기술</h5>
                                    <p>{{ candidate.skills }}</p>
                                </div>
                            </div>
                            {% endif %}
                        </div>

                        <div class="tab-pane" id="evaluations">
                            <div class="table-responsive">
                                <table class="table table-centered table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>평가자</th>
                                            <th>평가 항목</th>
                                            <th>점수</th>
                                            <th>평가일</th>
                                            <th>작업</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for evaluation in candidate.evaluations.all %}
                                        <tr>
                                            <td>{{ evaluation.evaluator.get_full_name }}</td>
                                            <td>{{ evaluation.get_evaluation_type_display }}</td>
                                            <td>
                                                <span class="badge bg-{{ evaluation.get_score_color }}">{{ evaluation.score }}/5</span>
                                            </td>
                                            <td>{{ evaluation.created_at|date:"Y-m-d" }}</td>
                                            <td>
                                                <a href="#" class="action-icon">
                                                    <i class="mdi mdi-eye"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="5" class="text-center">평가 내역이 없습니다.</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="tab-pane" id="interviews">
                            <div class="table-responsive">
                                <table class="table table-centered table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>면접 유형</th>
                                            <th>면접관</th>
                                            <th>일정</th>
                                            <th>상태</th>
                                            <th>작업</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for interview in candidate.interviews.all %}
                                        <tr>
                                            <td>{{ interview.get_interview_type_display }}</td>
                                            <td>{{ interview.interviewer.get_full_name }}</td>
                                            <td>{{ interview.scheduled_at|date:"Y-m-d H:i" }}</td>
                                            <td>
                                                <span class="badge bg-{{ interview.get_status_color }}">{{ interview.get_status_display }}</span>
                                            </td>
                                            <td>
                                                <a href="#" class="action-icon">
                                                    <i class="mdi mdi-eye"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="5" class="text-center">면접 내역이 없습니다.</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 